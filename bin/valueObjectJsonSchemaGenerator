#!/usr/bin/env php
<?php
/**
 * Генератор Json схемы для ValueObject в той же папке, где и сам файл
 */

namespace ArtSkillsCommon {
	require_once __DIR__ .'/../src/config/bootstrap.bin.php';

	use ArtSkills\Filesystem\Folder;
	use ArtSkills\ValueObject\ValueObjectDocumentation;

	if ($_SERVER['argc'] !== 4) {
		echo 'Usage: valueObjectJsDocGenerator src_file|src_dir dst_dir dst_uri' . PHP_EOL;
		exit(0);
	}

	if (is_dir($_SERVER['argv'][1])) {
		$dir = new Folder($_SERVER['argv'][1]);
		$fileList = $dir->findRecursive('.*\.php');
		foreach ($fileList as $filePath) {
			ValueObjectDocumentation::buildJsonSchema($filePath, $_SERVER['argv'][2], $_SERVER['argv'][3]);
		}
	} else {
		ValueObjectDocumentation::buildJsonSchema($_SERVER['argv'][1], $_SERVER['argv'][2], $_SERVER['argv'][3]);
	}
}